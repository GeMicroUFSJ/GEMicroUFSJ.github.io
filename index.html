<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Validação de Certificados - GEMICRO / UFSJ</title>
<style>
body { font-family: Arial, sans-serif; margin: 40px; text-align: center; }
.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
.header img { height: 100px; }
.title { font-size: 28px; font-weight: bold; margin-bottom: 30px; }
input { padding: 8px; width: 300px; font-size: 16px; }
button { padding: 8px 14px; font-size: 16px; margin-left: 10px; cursor: pointer; }
#resultadoCodigo, #resultadoNome { margin-top: 25px; font-size: 18px; }
a { color: #007bff; text-decoration: none; }
a:hover { text-decoration: underline; }
</style>
</head>
<body>

<div class="header">
  <img src="menu-logo_menor.png" alt="UFSJ">
  <img src="Logo_oficial.jpg" alt="GEMICRO">
</div>

<div class="title">Sistema de Validação de Certificados – GEMICRO / UFSJ</div>

<!-- Busca por Nome -->
<p>Buscar certificado pelo nome:</p>
<input type="text" id="nomeInput" placeholder="Ex.: Amanda">
<button onclick="buscarNome()">Buscar</button>
<div id="resultadoNome"></div>

<hr style="margin:40px 0;">

<!-- Busca por Código -->
<p>Digite o código de validação do certificado:</p>
<input type="text" id="codigoInput" placeholder="Ex.: GEMICRO-UFSJ-000001">
<button onclick="validarCodigo()">Validar</button>
<div id="resultadoCodigo"></div>

<script>
let dados = [];

// Carrega todos os arquivos JSON listados no manifest.json
async function carregarArquivos() {
    try {
        const manifest = await fetch("manifest.json").then(r => r.json());

        for (const arquivo of manifest.arquivos) {
            const j = await fetch(arquivo).then(r => r.json());
            dados = dados.concat(j.certificados);
        }

        console.log("Certificados carregados:", dados.length);

    } catch (e) {
        console.error("Erro ao carregar arquivos:", e);
    }
}

carregarArquivos();

// Busca por Código
function validarCodigo() {
    const codigo = document.getElementById("codigoInput").value.trim();
    const div = document.getElementById("resultadoCodigo");

    if (!codigo) {
        div.innerHTML = "<span style='color:#b00;'>❗ Digite um código.</span>";
        return;
    }

    const item = dados.find(x => x.codigo.toUpperCase() === codigo.toUpperCase());

    if (item) {
        div.innerHTML = "<span style='color:green;'>✔ Certificado válido.</span><br>Emitido para: <b>" 
                        + item.nome + "</b><br><a href='certificados/" + item.codigo + ".pdf' target='_blank'>Download do PDF</a>";
    } else {
        div.innerHTML = "<span style='color:#b00;'>✖ Código inválido.</span>";
    }
}

// Busca por Nome
function buscarNome() {
    const nome = document.getElementById("nomeInput").value.trim().toLowerCase();
    const div = document.getElementById("resultadoNome");

    if (!nome) {
        div.innerHTML = "<span style='color:#b00;'>❗ Digite um nome.</span>";
        return;
    }

    const resultados = dados.filter(x => x.nome.toLowerCase() === nome);

    if (resultados.length > 0) {
        let html = "";
        resultados.forEach(item => {
            html += "✔ " + item.nome + " (<b>" + item.codigo + "</b>) - <a href='certificados/" + item.codigo + ".pdf' target='_blank'>Download do PDF</a><br>";
        });
        div.innerHTML = html;
    } else {
        div.innerHTML = "<span style='color:#b00;'>✖ Nenhum certificado encontrado para este nome.</span>";
    }
}
</script>

<hr style="margin-top: 40px;">

<div style="margin-top: 25px; text-align: center;">

  <p style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">
    Contato
  </p>

  <!-- Ícones -->
  <a href="https://www.instagram.com/gemicro_ufsj/" target="_blank" 
     style="margin-right: 20px; text-decoration: none;">
    <img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" 
         alt="Instagram" width="40" height="40">
  </a>

  <a href="mailto:gemicro@ufsj.edu.br" 
     style="text-decoration: none;">
    <img src="https://cdn-icons-png.flaticon.com/512/732/732200.png" 
         alt="Email" width="40" height="40">
  </a>

</div>

</body>
</html>
